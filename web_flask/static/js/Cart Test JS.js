// Existing fruit and vegetable products list
const fruitVegetableProducts = [
    {
        id: 0,
        image: '../static/images/images/chair1.webp',
        title: 'COOLER MASTER Caliber X2 Gaming Chair BLACK',
        price: 21999,
        quantity: 1
    },
    {
        id: 1,
        image: '../static/images/images/chair2.webp',
        title: 'COOLER MASTER Caliber R3C Gaming Chair BLACK',
        price: 16999,
        quantity: 1
    },
    {
        id: 2,
        image: '../static/images/images/chair3.webp',
        title: 'Cooler Master Caliber E1 Gaming Chair, Black And Purple',
        price: 9999,
        quantity: 1
    },
    {
        id: 3,
        image: '../static/images/images/chair4.webp',
        title: 'Cooler Master Caliber E1 Gaming Chair, Black',
        price: 9999,
        quantity: 1
    },
    {
        id: 4,
        image: '../static/images/images/chair5.gif',
        title: 'Cooler Master CHAIR Caliber R3 Gaming Chair — Purple',
        price: 14999,
        quantity: 1
    },
    {
        id: 5,
        image: '../static/images/images/chair6.gif',
        title: 'Cooler Master CHAIR CMI-GCR3-BK Caliber R3 Gaming Chair - Black',
        price: 14999,
        quantity: 1
    },
    {
        id: 6,
        image: '../static/images/images/chair7.jpg',
        title: 'HAVIT CHAIR GAMING GC932 BLACK BLUE',
        price: 8999,
        quantity: 1
    },
    {
        id: 7,
        image: '../static/images/images/chair8.webp',
        title: 'Redragon Chair C602',
        price: 7999,
        quantity: 1
    },
    {
        id: 8,
        image: '../static/images/images/chair9.webp',
        title: 'Redragon Chair C211',
        price: 8299,
        quantity: 1
    }
];
// Adding meat products to the existing fruitVegetableProducts array
const meatProducts = [
    {
        id: 21,
        image: '../static/images/images/camera1.webp',
        title: 'Logitech Brio 100 Full HD 1080p Webcam Made for Meetings ',
        price: 2299,
        quantity: 1
    },
    {
        id: 22,
        image: '../static/images/images/camera2.webp',
        title: 'Logitech Brio 100 Full HD 1080p Webcam for Meetings and Streaming',
        price: 2299,
        quantity: 1
    },
    {
        id: 23,
        image: '../static/images/images/camera3.webp',
        title: 'Logitech Brio 100 Full HD 1080p Webcam - Off White',
        price: 2299,
        quantity: 1
    },
    {
        id: 24,
        image: '../static/images/images/camera4.webp',
        title: 'Logitech Brio 500 Full HD Webcam with Auto Light Correction',
        price: 8299,
        quantity: 1
    },
    {
        id: 25,
        image: '../static/images/images/camera5.webp',
        title: 'Logitech C270 Widescreen HD Webcam',
        price: 1699,
        quantity: 1
    },
    {
        id: 26,
        image: '../static/images/images/camera6.webp',
        title: 'Logitech HD Laptop Webcam C615 with Fold-and-Go Design, 360',
        price: 3599,
        quantity: 1
    },
    {
        id: 27,
        image: '../static/images/images/camera7.webp',
        title: 'A4TECH PK-940HA FHD 1080P AF Webcam-BLACK',
        price: 850,
        quantity: 1
    },
    {
        id: 28,
        image: '../static/images/images/camera8.webp',
        title: 'LOGITECH WEBCAM C930E BUSINESS Advanced 1080p business with H.264 support',
        price: 2300,
        quantity: 1
    },
    {
        id: 29,
        image: '../static/images/images/camera9.webp',
        title: 'D-LINK DCS-6500LH Compact Full HD Pan & Tilt Wi-Fi Camera',
        price: 625,
        quantity: 1
    }
];
// Adding meat products to the existing fruitVegetableProducts array
const bakeryProducts = [
    {
        id: 33,
        image: '../static/images/images/speaker1.webp',
        title: 'MEETION SP1001 Office Strip Desktop Speakers',
        price: 499,
        quantity: 1
    },
    {
        id: 34,
        image: '../static/images/images/speaker2.webp',
        title: 'MEETION SP2011Gaming Stereo Desktop Speakers',
        price: 349,
        quantity: 1
    },
    {
        id: 35,
        image: '../static/images/images/speaker3.webp',
        title: 'MEETION SP2010 2.0 Office Desktop Speakers',
        price: 275,
        quantity: 1
    },
    {
        id: 36,
        image: '../static/images/images/speaker4.webp',
        title: 'LOGITECH WONDERBOOM Super Portable Waterproof Bltooth Speaker Grey',
        price: 2499,
        quantity: 1
    },
    {
        id: 37,
        image: '../static/images/images/speaker5.webp',
        title: 'SPEAKER-HAVIT-Audio series-2.0 speaker',
        price: 175,
        quantity: 1
    },
    {
        id: 38,
        image: '../static/images/images/speaker6.jpg',
        title: 'SPEAKER-HAVIT- Sk717 Havit Indoor Desktop Mini Small',
        price: 175,
        quantity: 1
    },
    {
        id: 39,
        image: '../static/images/images/speaker7.jpg',
        title: 'HAVIT SK204 Stereo electronic sports speaker',
        price: 349,
        quantity: 1
    },
    {
        id: 40,
        image: '../static/images/images/speaker8.jpg',
        title: 'HAVIT SK201 Stereo electronic sports speaker',
        price: 399,
        quantity: 1
    },
    {
        id: 41,
        image: '../static/images/images/speaker9.jpg',
        title: 'HAVIT Gamenote gaming speaker sk205 With RGB Light',
        price: 349,
        quantity: 1
    }
];
// Adding meat products to the existing fruitVegetableProducts array
const snacksProducts = [
    {
        id: 45,
        image: '../static/images/images/keyboard1.webp',
        title: 'Ugreen MK006 Wireless Keyboard + Mouse Combo English & Arabic',
        price: 799,
        quantity: 1
    },
    {
        id: 46,
        image: '../static/images/images/keyboard2.webp',
        title: 'Rapoo X1960 Wireless Compo Keyboard & Mouse - Black',
        price: 799,
        quantity: 1
    },
    {
        id: 47,
        image: '../static/images/images/keyboard3.webp',
        title: 'MEETION C500 Backlit Gaming Combo Kits 4 in 1',
        price: 1199,
        quantity: 1
    },
    {
        id: 48,
        image: '../static/images/images/keyboard4.webp',
        title: 'MEETION C490 4 IN 1 PC Gaming Kits',
        price: 825,
        quantity: 1
    },
    {
        id: 49,
        image: '../static/images/images/keyboard5.webp',
        title: 'MEETION MK80 Ultrathin Mechanical Keyboard Blue switch',
        price: 2399,
        quantity: 1
    },
    {
        id: 50,
        image: '../static/images/images/keyboard6.webp',
        title: 'MEETION MK20 Full Key Anti-ghosting Metal Mechanical Keyboard',
        price: 1599,
        quantity: 1
    },
    {
        id: 51,
        image: '../static/images/images/keyboard7.webp',
        title: 'MEETION MK500 Colorful Adjustable Rainbow Backlight blue switches',
        price: 1399,
        quantity: 1
    },
    {
        id: 52,
        image: '../static/images/images/keyboard8.webp',
        title: 'MEETION MK01 RGB MECHANICAL KEYBOARD',
        price: 1699,
        quantity: 1
    },
    {
        id: 53,
        image: '../static/images/images/keyboard9.webp',
        title: 'MEETION MK04 TKL RGB Backlit Multimedia Blue Switch Mechanical',
        price: 1299,
        quantity: 1
    }
];
const dairyProducts = [
    {
        id: 57,
        image: '../static/images/images/headset1.webp',
        title: 'Havit Gaming Headphones H2015E with Microphone, 53mm Speaker',
        price: 1099,
        quantity: 1
    },
    {
        id: 58,
        image: '../static/images/images/headset2.webp',
        title: 'Havit Gamenote H2230D Gaming Gaming Headset with Microphone 3.5mm',
        price: 699,
        quantity: 1
    },
    {
        id: 59,
        image: '../static/images/images/headset3.webp',
        title: 'Havit H2002S Gaming Headphone, Black',
        price: 1499,
        quantity: 1
    },
    {
        id: 60,
        image: '../static/images/images/headset4.webp',
        title: 'Logitech Zone 300 Wireless Bluetooth Headset With Noise-Cancelling',
        price: 1200,
        quantity: 1
    },
    {
        id: 61,
        image: '../static/images/images/headset5.webp',
        title: 'Logitech Zone 300 Wireless Bluetooth Headset With Noise-Cancelling Microphone, Compatible',
        price: 1300,
        quantity: 1
    },
    {
        id: 62,
        image: '../static/images/images/headset6.webp',
        title: 'MEETION HP030 HIFI Backlit Gaming Headset',
        price: 545,
        quantity: 1
    },
    {
        id: 63,
        image: '../static/images/images/headset7.webp',
        title: 'MEETION U003 Stand For Gaming Headphone',
        price: 649,
        quantity: 1
    },
    {
        id: 64,
        image: '../static/images/images/headset8.webp',
        title: 'ONIKUMA X25 RGB Gaming Headset White Edition',
        price: 649,
        quantity: 1
    },
    {
        id: 65,
        image: '../static/images/images/headset9.webp',
        title: 'ONIKUMA X26 Head-mounted Earphone RGB Light, Noise Reduction Wired',
        price: 649,
        quantity: 1
    }
];

const babyProducts = [
    {
        id: 66,
        image: '../static/images/mic1.webp',
        title: "MEETION MC20 Professional Wired Conference Game Microphone",
        price: 849,
        quantity: 1
    },
    {
        id: 67,
        image: '../static/images/mic2.webp',
        title: "REDRAGON Microphone GM303",
        price: 1400,
        quantity: 1
    },
    {
        id: 68,
        image: '../static/images/mic3.webp',
        title: 'REDRAGON Microphone GM301',
        price: 3070,
        quantity: 1
    },
    {
        id: 69,
        image: '../static/images/mic4.jpg',
        title: 'HyperX SoloCast 4P5P8AA USB Microphone (Black)',
        price: 3100,
        quantity: 1
    },
    {
        id: 70,
        image: '../static/images/mic5.jpg',
        title: "BOYA MIC Omnidirectional Lavalier Microphone - BY-M1",
        price: 400,
        quantity: 1
    },
    {
        id: 70,
        image: '../static/images/mic6.jpg',
        title: "HyperX QuadCast S – USB Condenser Gaming",
        price: 8250,
        quantity: 1
    },
    {
        id: 70,
        image: '../static/images/mic7.webp',
        title: "HyperX ProCast Standalone Microphone ",
        price: 7499,
        quantity: 1
    },
    {
        id: 70,
        image: '../static/images/mic8.webp',
        title: "HyperX SoloCast - USB Condenser Microphone for Gaming, for PC",
        price: 2300,
        quantity: 1
    },
    {
        id: 71,
        image: '../static/images/mic9.webp',
        title: 'HyperX QuadCast S RGB USB Condenser Microphone',
        price: 3850,
        quantity: 1
    }
];

const medicineProducts = [
    {
        id: 72,
        image: '../static/images/images/pad1.webp',
        title: 'Meetion PD005 Soft Rubber Mouse Pad',
        price: 59,
        quantity: 1
    },
    {
        id: 73,
        image: '../static/images/images/pad2.webp',
        title: 'MEETION P010 RGB Backlit Gaming Mouse Pad',
        price: 549,
        quantity: 1
    },
    {
        id: 74,
        image: '../static/images/images/pad3.webp',
        title: 'MEETION PD121 Large RGB Mouse Pad for Gaming',
        price: 499,
        quantity: 1
    },
    {
        id: 75,
        image: '../static/images/images/pad4.webp',
        title: 'MEETION PD015 Soft Rubber Gaming Mouse Pad',
        price: 599,
        quantity: 1
    },
    {
        id: 76,
        image: '../static/images/images/pad5.webp',
        title: 'HV-MP839 Gaming Mousepad 250 x 210 x 2 mm',
        price: 999,
        quantity: 1
    },
    {
        id: 77,
        image: '../static/images/images/pad6.webp',
        title: 'HAVIT MP848 Gaming Mousepad, black+Red',
        price: 249,
        quantity: 1
    },
    {
        id: 78,
        image: '../static/images/images/pad7.webp',
        title: 'Cooler Master MP511 L CORDURA Gaming Mouse Pad',
        price: 549,
        quantity: 1
    },
    {
        id: 79,
        image: '../static/images/images/pad8.webp',
        title: 'Redragon P015 Large Extended Mouse Pad XXL, with Stitched Edges',
        price: 500,
        quantity: 1
    },
    {
        id: 80,
        image: '../static/images/images/pad9.webp',
        title: 'LOGITECH Mouse Pad Studio Series ',
        price: 399,
        quantity: 1
    }
];



// Merge fruitVegetableProducts and meatProducts into a single categories array
const categories = [...fruitVegetableProducts, ...meatProducts, ...bakeryProducts, ...snacksProducts, ...dairyProducts, ...babyProducts, ...medicineProducts];
let i = 0;
// Function to switch between displaying fruit/vegetable and meat products
function switchCategory(category) {
    if (category === 'fruitVegetableProducts') {
        document.getElementById('categoryTitle').textContent = 'Chairs';
    } else if (category === 'meatProducts') {
        document.getElementById('categoryTitle').textContent = 'Camera';
    }
    else if (category === 'bakeryProducts') {
        document.getElementById('categoryTitle').textContent = 'Speakers';
    }
    else if (category === 'snacksProducts') {
        document.getElementById('categoryTitle').textContent = 'keyboard&Mouses';
    }
    else if (category === 'dairyProducts') {
        document.getElementById('categoryTitle').textContent = 'Headset';
    }
    else if (category === 'babyProducts') {
        document.getElementById('categoryTitle').textContent = 'microphone';
    }
    else if (category === 'medicineProducts') {
        document.getElementById('categoryTitle').textContent = 'Pad';
    }

    
    displayProducts(category);
}
// Initial display of products (default: fruit/vegetable products)
displayProducts('fruitVegetableProducts');
// Function to display products based on the selected category
function displayProducts(category) {
    let products;
    if (category === 'fruitVegetableProducts') {
        products = fruitVegetableProducts;
    } else if (category === 'meatProducts') {
        products = meatProducts;
    } else if (category === 'bakeryProducts') {
        products = bakeryProducts;
    } else if (category === 'snacksProducts') {
        products = snacksProducts;
    }else if (category === 'dairyProducts') {
        products = dairyProducts;
    }else if(category === 'babyProducts') {
        products = babyProducts;
    }else if(category === 'medicineProducts') {
        products = medicineProducts;
    }else {
        products = [];
    }
    document.getElementById('root').innerHTML = products.map((item) => {
        var { image, title, price } = item;
        return (
            `<div class='box'>
                <div class='img-box'>
                    <img class='images' src=${image}></img>
                </div>
                <div class='bottom'>
                    <p>${title}</p>
                    <h2>LE ${price}.00</h2>
                    <button onclick='addtocart(${item.id})'>Add to cart</button>
                </div>
            </div>`
        );
    }).join('');
}
var cart = []; // This holds data sent to Flask
var dcart = []; // This holds data for display only

function addtocart(productId) {
    const selectedProduct = categories.find(item => item.id === productId);
    const itemIndex = cart.findIndex(item => item.id === productId);
    
    if (itemIndex > -1) {
        cart[itemIndex].quantity += 1;
    } else {
        // Add the product details to the cart
        const { id, title, image, price, quantity } = selectedProduct;
        cart.push({ id, title, image, price, quantity });
    }
    
    // Update the display-only cart (dcart)
    const displayItemIndex = dcart.findIndex(item => item.id === productId);
    if (displayItemIndex > -1) {
        dcart[displayItemIndex].quantity += 1;
    } else {
        dcart.push({ ...selectedProduct, quantity: 1 });
    }
    
    // Update the cart display
    displaycart();
    
    // Prepare cart data for Flask
    const cartDataForServer = cart.map(item => ({
        title: item.title,
        image: item.image,
        price: item.price,
        quantity: item.quantity
    }));
    
    // Send cart data to Flask
    fetch('/process_cart', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ cart: cartDataForServer }), // Pass processed cart data
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to send cart data to server');
        }
        return response.json();
    })
    .then(data => {
        console.log(data); // Optional: Handle success response from server
        
        // Clear the cart after successfully sending data to server
        cart.length = 0;
        displaycart(); // Update cart display to show it's empty
    })
    .catch(error => {
        console.error('Error:', error); // Optional: Handle error case
    });
}

function delElement(a) {
    const productTitle = dcart[a].title;

    // Send DELETE request to Flask server to remove item from storage
    fetch(`/remove_item_by_title/${encodeURIComponent(productTitle)}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            console.error('Error:', data.error);
        } else {
            // Update the display-only cart (dcart) based on server response
            if (dcart[a].quantity > 1) {
                dcart[a].quantity -= 1;
            } else {
                dcart.splice(a, 1);
            }

            // Update the cart display
            displaycart();
        }
    })
    .catch(error => {
        console.error('Error:', error); // Optional: Handle error case
    });
}



function displaycart() {
    let total = 0;
    document.getElementById("count").innerHTML = dcart.length;

    if (dcart.length === 0) {
        document.getElementById('cartItem').innerHTML = "Your cart is empty";
        document.getElementById("total").innerHTML = "LE " + 0 + ".00";
    } else {
        // Calculate the total price
        total = dcart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
        document.getElementById("total").innerHTML = "LE " + total + ".00";

        // Display cart items on the client side
        document.getElementById("cartItem").innerHTML = dcart.map((item, index) => {
            return (
                `<div class='cart-item'>
                    <div class='row-img'>
                        <img class='rowimg' src=${item.image}>
                    </div>
                    <p style='font-size:12px;'>${item.title}</p>
                    <p style='font-size:12px;'>Quantity: ${item.quantity}</p>
                    <h2 style='font-size: 15px;'>LE ${item.price * item.quantity}.00</h2>
                    <i class='fa-solid fa-trash' onclick='delElement(${index})'></i>
                </div>`
            );
        }).join('');
    }
}

// Assuming you have included this script at the end of your HTML body or use window.onload or DOMContentLoaded event

// script.js

document.addEventListener('DOMContentLoaded', function() {
    // Select the 'Proceed to Checkout' button
    const checkoutButton = document.getElementById('checkoutButton');

    if (checkoutButton) {
        checkoutButton.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent default action of anchor tag

            // Fetch cart data or use existing data from your page
            const cartData = JSON.parse(localStorage.getItem('cart')) || [];

            // Prepare payload for POST request
            const payload = {
                cart: cartData
            };

            // Send POST request to /checkout endpoint
            fetch('/checkout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Handle successful response
                console.log(data.message); // Log success message
                // Optionally, redirect to checkout details page or handle UI updates
            })
            .catch(error => {
                // Handle errors
                console.error('Error:', error);
                // Optionally, display an error message to the user
            });
        });
    }
});
   // commented

   document.addEventListener('DOMContentLoaded', function() {
    // Select the search form and input
    const searchForm = document.getElementById('search-boxx');
    const searchInput = document.getElementById('search-input');

    // Add an event listener to the search form
    searchForm.addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent form submission
        const query = searchInput.value.toLowerCase(); // Get the search query
        filterProducts(query); // Call the filter function
    });

    // Function to filter products based on the search query
    function filterProducts(query) {
        // Filter the categories array based on the query
        const filteredProducts = categories.filter(product => product.title.toLowerCase().includes(query));
        displayFilteredProducts(filteredProducts); // Display the filtered products
    }

    // Function to display filtered products
    function displayFilteredProducts(products) {
        document.getElementById('root').innerHTML = products.map((item) => {
            var { image, title, price } = item;
            return (
                `<div class='box'>
                    <div class='img-box'>
                        <img class='images' src=${image}></img>
                    </div>
                    <div class='bottom'>
                        <p>${title}</p>
                        <h2>LE ${price}.00</h2>
                        <button onclick='addtocart(${item.id})'>Add to cart</button>
                    </div>
                </div>`
            );
        }).join('');
    }

});

function changeText(link) {
    link.innerHTML = 'Order Added &#10004;'; 
    link.classList.add('pressed');
}



